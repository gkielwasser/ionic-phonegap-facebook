!function(a,b){function c(){a.cordova?b.addEventListener("deviceready",d,!1):d(),a.removeEventListener("load",c,!1)}function d(){function c(){if(void 0==navigator.connection)a.localStorage.setItem("internetAccessFlag","false");else{var b=navigator.connection.type,c={};c[Connection.UNKNOWN]="Unknown connection",c[Connection.ETHERNET]="Ethernet connection",c[Connection.WIFI]="WiFi connection",c[Connection.CELL_2G]="Cell 2G connection",c[Connection.CELL_3G]="Cell 3G connection",c[Connection.CELL_4G]="Cell 4G connection",c[Connection.NONE]="No network connection",b==Connection.UNKNOWN||b==Connection.NONE?a.localStorage.setItem("internetAccessFlag","false"):a.localStorage.setItem("internetAccessFlag","true")}}function e(a){angular.bootstrap(b,["starter"]),a&&(b.removeEventListener("online",!1),b.removeEventListener("resume",!1))}a.cordova?c():navigator.onLine?a.localStorage.setItem("internetAccessFlag","true"):a.localStorage.setItem("internetAccessFlag","false"),"true"==a.localStorage.getItem("internetAccessFlag")?angular.element(b).ready(function(){e()}):(alert("Vous devez être connecté à Internet"),b.addEventListener("resume",function(){e()},!1),b.addEventListener("online",function(){e()},!1)),b.removeEventListener("deviceready",d,!1)}a.addEventListener("load",c,!1)}(window,document),angular.module("starter",["ionic","ngTouch","starter.services","starter.controllers","starter.directives","facebook","mallzee.ui-table-view"]).run(["$rootScope","$state","$urlRouter","application_conf","application_conf_web","application_conf_mobile",function(a,b,c,d,e,f){FastClick.attach(document.body),a.$on("$stateChangeSuccess",function(d){d.preventDefault();var e;"true"===window.localStorage.didTutorial?(e=!0,a.enableSideMenu=!0):(e=!1,a.enableSideMenu=!1),e?c.sync():b.go("menu.intro")}),cordova?(angular.extend(d.facebook,f.facebook),angular.extend(d.general,f.general)):(angular.extend(d.facebook,e.facebook),angular.extend(d.general,e.general))}]).config(["$stateProvider","$urlRouterProvider","FacebookProvider","application_conf_web","application_conf_mobile",function(a,b,c,d,e){a.state("menu",{url:"","abstract":!0,templateUrl:"views/menu.html"}).state("menu.friends",{url:"/friends",views:{menuContent:{templateUrl:"views/friends.html",controller:"FriendsCtrl"}}}).state("menu.subscribedFriends",{url:"/subscribedFriends",views:{menuContent:{templateUrl:"views/subscribedFriends.html",controller:"SubscribedFriendsCtrl"}}}).state("menu.about",{url:"/about",views:{menuContent:{templateUrl:"views/about.html"}}}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginCtrl"}).state("menu.intro",{url:"/intro",views:{menuContent:{templateUrl:"views/intro.html",controller:"IntroCtrl"}}}),b.otherwise("/about"),cordova?c.init(e.facebook.init,!1):c.init(d.facebook.init)}]).filter("startFrom",function(){return function(a,b){return a?a.slice(b):!1}}),angular.module("starter").value("application_conf",{facebook:{permissions:"basic_info",friends_fields:"id,name,first_name,last_name,picture,installed",me_fields:"username,picture"},general:{}}).constant("application_conf_web",{general:{overflowScroll:!0,application_path:"192.168.0.45:9000/"},facebook:{init:{appId:"711009162272801",frictionlessRequests:!0,status:!1}}}).constant("application_conf_mobile",{general:{overflowScroll:!0},facebook:{init:{appId:"711009162272801",oauth:!0,localSDK:"facebook-js-sdk.js",nativeInterface:CDV.FB,status:!1,frictionlessRequests:!0,useCachedDialogs:!1,cookies:!0}}}),angular.module("starter.controllers",[]).controller("IntroCtrl",["$scope","$state",function(a,b){var c=function(){b.go("menu.about"),window.localStorage.didTutorial=!0};"true"===window.localStorage.didTutorial&&c(),a.next=function(){a.$broadcast("slideBox.nextSlide")};var d=[{content:'<i class="icon ion-chevron-right"></i>',type:"button-positive ion ",tap:function(){a.next()}}],e=[{content:"Passer",type:"button-positive",tap:function(){c()}}];a.leftButtons=e,a.rightButtons=d,a.slideChanged=function(b){a.leftButtons=b>0?[{content:'<i class="icon ion-chevron-left"></i>',type:"button-positive",tap:function(){a.$broadcast("slideBox.prevSlide")}}]:e,a.rightButtons=2==b?[{content:"J'ai tout compris !",type:"button-balanced button",tap:function(){c()}}]:d}}]).controller("ModalCtrl",["$scope","$ionicModal",function(a,b){a.$watch("getSelectedFriend()",function(b){a.modal&&b&&0==b.length&&a.closeModal()},!0),b.fromTemplateUrl("views/friendsConfirmationModal.html",function(b){a.modal=b},{scope:a,animation:"slide-in-up"}),a.openModal=function(){a.modal.show()},a.closeModal=function(){a.modal.hide()}}]).controller("SubscribedFriendsCtrl",["$scope","UserService","$filter",function(a,b,c){a.initSubscribedFriends=function(){a.$watch(b.friends,function(b){b&&(a.friends=c("filter")(b,{installed:!0}))})}}]).controller("FriendsCtrl",["$scope","UserService","$timeout","$q","$filter",function(a,b,c,d,e){var f=[{content:"Annuler",tap:function(){a.reset()}}],g=function(b){b?a.rightButtons=f:delete a.rightButtons};a.$watch(b.friends,function(b){b&&a.initFriendsCtrl(b)}),a.initFriendsCtrl=function(b){a.initFriendsPartial(b)},a.list=[];for(var h=0;1e3>h;h++)a.list.push({id:h,name:"Name "+h,detail:"Detail "+h});a.initFriendsPartial=function(b){a.friends=b,a.currentPage=0,a.pageSize=15,a.numberOfPages=function(){return Math.ceil(e("filter")(a.friends,{name:a.search}).length/a.pageSize)}},a.setCurrentPage=function(b){a.currentPage=b},a.nextPage=function(){a.currentPage++,a.$broadcast("scroll.scrollTop")},a.previousPage=function(){a.currentPage--,a.$broadcast("scroll.scrollTop")},a.searching=function(){a.$broadcast("scroll.scrollTop"),a.currentPage=0},a.getNumberAsArray=function(a){return new Array(a)},a.loadMore=function(a){c(function(){a()},500)},a.$watch("friends",function(b){a.modal&&b&&0==a.getSelectedFriend().length&&a.closeModal(),a.getSelectedFriend()&&0==a.getSelectedFriend().length?g(!1):!a.rightButtons&&a.getSelectedFriend()&&a.getSelectedFriend().length>0&&g(!0)},!0),a.reset=function(){angular.forEach(a.friends,function(a){a.enabled=!1})},a.addFriend=function(a,b){"INPUT"!=b.target.tagName&&(a.enabled=a.enabled?!1:!0)},a.addItems=function(){for(var b=0;10>b;b++)if(a.friends.push(),a.friends.length>=a.maxItems)return void(a.canLoad=!1)},a.getSelectedFriend=function(){return e("filter")(a.friends,{enabled:!0})},a.sendFriendsInvitation=function(c){b.sendFriendsInvitation(a.getSelectedFriend(),c)}}]).controller("leftMenuCtrl",["$scope","UserService","$state",function(a,b,c){a.$on("toggleSideMenu",function(){a.sideMenuController.toggleLeft()}),a.$on("closeSideMenu",function(){a.sideMenuController.close()}),a.closeMenu=function(b){a.sideMenuController.close(),c.go(b)},a.logout=function(){b.logout(function(){c.go("login")})},a.login=function(){b.login()}}]).controller("MainCtrl",["$scope","$state","UserService","application_conf","$rootScope","$ionicLoading","ConnectService",function(a,b,c,d,e,f){a.application_conf=d,a.leftButtons=[{type:"button-clear",content:'<i class="icon ion-navicon">',tap:function(){a.$broadcast("toggleSideMenu")}}],a.closeMenu=function(){},a.$watch(c.user,function(b){a.user=b},!0),a.toIntro=function(){window.localStorage.didTutorial="false",a.$broadcast("closeSideMenu"),b.go("menu.intro")},e.showLoading=function(a){a=a||"Chargement",e.loading=f.show({content:'<i class=" ion-loading-c"></i> '+a,animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0})},e.hideLoading=function(){e.loading.hide()}}]),angular.module("starter.services",[]).service("ConnectService",["$ionicLoading","$window","$rootScope",function(a,b,c){var d,e=function(){d=a.show({content:'<i class=" ion-alert-circled"></i> Une connexion Internet est nécessaire',animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0})},f=function(){d&&d.hide()},g=function(){f()},h=function(){e()},i={};return i.onLine=b.navigator.onLine,b.navigator.onLine?g():h(),i.isOnline=function(){return i.onLine},b.addEventListener("online",function(){i.onLine=!0,g(),c.$digest()},!0),b.addEventListener("offline",function(){i.onLine=!1,h(),c.$digest()},!0),{offline:function(){h()},online:function(){g()}}}]).factory("UserService",["$rootScope","Facebook","$q","application_conf","$filter",function(a,b,c,d,e){var f=!1;a.$watch(function(){return b.isReady()},function(){a.facebookReady=!0});var g={},h=!1;a.$on("Facebook:login",function(){}),a.$on("Facebook:logout",function(){}),a.$on("Facebook:prompt",function(){}),a.$on("Facebook:sessionChange",function(){}),a.$on("Facebook:statusChange",function(a,b){j(b,"statusChange")}),a.$on("Facebook:authResponseChange",function(){});var i=function(b,d){function e(){a.hideLoading(),g.logged=!0,f=!0,h.resolve()}if(!d&&!f){var h=c.defer();a.showLoading();var i=[];return i.push(n()),i.push(m()),c.all(i).then(e),h}},j=function(a,b){a.authResponse&&a.authResponse.accessToken?i(b):k()},k=function(){g={},h=!1,g.logged=!1,f=!1},l=function(){return b.logout(function(){})},m=function(){var e=c.defer();return b.api("/me/friends?fields="+d.facebook.friends_fields,function(b){b.error||a.$apply(function(){g.friends=b.data,e.resolve()})}),e.promise},n=function(){b.api("/me?fields="+d.facebook.me_fields,function(b){b.error||a.$apply(function(){g.me=b})})},o=function(){a.showLoading("Connexion Facebook");var e=c.defer();return b.login(function(b){b.authResponse&&"connected"==b.status,a.hideLoading(),e.resolve()},{scope:d.facebook.permissions}),e.promise},p=function(){var a=c.defer();return b.getLoginStatus(function(a){j(a,"getLoginStatus")}),a.promise};return p(),{getLoginStatus:function(){return p()},logged:function(){return g.logged?g:!1},user:function(){return g},login:function(){return o()},profile:function(){return g.profile},friends:function(){return g.friends},subscribedFriends:function(){return g.subscribedFriends},logout:function(){return l()},sendFriendsInvitation:function(a,b){var c=[];angular.forEach(e("filter")(a),function(a){c.push(a.id)}),FB.ui({method:"apprequests",to:c,message:b||"Voilà une super application pour ..."},function(){})}}}]),angular.module("starter.directives",[]).directive("whenScrolled",["$timeout",function(a){return function(b,c){var d,e=c[0];a(function(){e.scrollTop=e.scrollHeight}),c.bind("scroll",function(){d>e.scrollTop,d=e.scrollTop})}}]).directive("connectivity",["$window","$parse",function(a,b){return function(c,d,e){var f=c.$eval(e.connectivity);angular.forEach(f,function(d,e){switch(fn=b(d),e){case"connect":c.connect=fn,a.addEventListener("online",function(){c.$apply(function(){fn(c)})},!1);break;case"disconnect":c.disconnect=fn,a.addEventListener("offline",function(){c.$apply(function(){fn(c)})},!1)}}),navigator.onLine?c.connect(c):c.disconnect(c)}}]).directive("postRepeatDirective",["$timeout",function(a){return function(b){b.$first&&(window.a=new Date),b.$last&&a(function(){})}}]);