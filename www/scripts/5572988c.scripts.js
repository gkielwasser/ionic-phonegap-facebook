"use strict";angular.module("starter",["ionic","ngTouch","starter.services","starter.controllers","starter.directives","starter.filters","facebook","templates-main"]),angular.module("starter").config(["$stateProvider","$urlRouterProvider","FacebookProvider","application_conf_web","application_conf_mobile",function(a,b,c,d,e){a.state("menu",{url:"","abstract":!0,templateUrl:"views/menu.html"}).state("menu.friends",{url:"/friends",views:{menuContent:{templateUrl:"views/friends.html",controller:"FriendsCtrl"}},access:1}).state("menu.subscribedFriends",{url:"/subscribedFriends",views:{menuContent:{templateUrl:"views/subscribedFriends.html",controller:"SubscribedFriendsCtrl"}},access:1}).state("menu.home",{url:"/home",views:{menuContent:{templateUrl:"views/home.html",controller:"HomeCtrl"}},access:0}).state("menu.about",{url:"/about",views:{menuContent:{templateUrl:"views/about.html"}},access:0}).state("menu.inputs",{url:"/inputs",views:{menuContent:{templateUrl:"views/inputs-test.html"}},access:0}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginCtrl",access:0}).state("menu.intro",{url:"/intro",views:{menuContent:{templateUrl:"views/intro.html",controller:"IntroCtrl"}},access:0}),b.otherwise("/home"),"undefined"!=typeof cordova?(console.log("CORDOVA ENABLED"),c.init(e.facebook.init,!1)):(console.log("CORDOVA DISABLED",d.facebook.init),c.init(d.facebook.init))}]),angular.module("starter").run(["$rootScope","$state","$urlRouter","application_conf","application_conf_web","application_conf_mobile","UserService",function(a,b,c,d,e,f){FastClick.attach(document.body),a.$on("$stateChangeSuccess",function(d,e){d.preventDefault(),"true"===window.localStorage.didTutorial?(console.log("Skip intro",e),a.enableSideMenu=!0,c.sync()):(b.go("menu.intro"),a.enableSideMenu=!1)}),"undefined"!=typeof cordova?(angular.extend(d.facebook,f.facebook),angular.extend(d.general,f.general)):(angular.extend(d.facebook,e.facebook),angular.extend(d.general,e.general))}]),function(a,b){function c(){a.cordova?(console.log("we are on mobile"),b.addEventListener("deviceready",d,!1)):(console.log("we are on browser"),d()),a.removeEventListener("load",c,!1)}function d(){function c(){if(console.log(navigator.connection),void 0==navigator.connection)a.localStorage.setItem("internetAccessFlag","false");else{var b=navigator.connection.type,c={};c[Connection.UNKNOWN]="Unknown connection",c[Connection.ETHERNET]="Ethernet connection",c[Connection.WIFI]="WiFi connection",c[Connection.CELL_2G]="Cell 2G connection",c[Connection.CELL_3G]="Cell 3G connection",c[Connection.CELL_4G]="Cell 4G connection",c[Connection.NONE]="No network connection",b==Connection.UNKNOWN||b==Connection.NONE?a.localStorage.setItem("internetAccessFlag","false"):a.localStorage.setItem("internetAccessFlag","true")}}function e(a){angular.bootstrap(b,["starter"]),a&&(b.removeEventListener("online",!1),b.removeEventListener("resume",!1))}a.cordova?(console.log("mobile check"),c()):(console.log("brower check"),navigator.onLine?a.localStorage.setItem("internetAccessFlag","true"):a.localStorage.setItem("internetAccessFlag","false")),"true"==a.localStorage.getItem("internetAccessFlag")?angular.element(b).ready(function(){console.log("ANGULAR WILL BOOTSTRAP"),e()}):(alert("Vous devez être connecté à Internet"),b.addEventListener("resume",function(){console.log("ONLINE"),e()},!1),b.addEventListener("online",function(){console.log("ONLINE"),e()},!1)),b.removeEventListener("deviceready",d,!1)}a.addEventListener("load",c,!1)}(window,document);var nativeInterface;"undefined"!=typeof CDV?(console.log("Cordova is defined **!"),nativeInterface=CDV.FB):console.log("Cordova is defined **!"),angular.module("starter").value("application_conf",{facebook:{permissions:"basic_info",friends_fields:"id,last_name,first_name,last_name,picture,installed",me_fields:"username,picture"},general:{}}).constant("application_conf_web",{general:{overflowScroll:!1,has_bouncing:!1,application_path:"192.168.0.42:9000/",scroll:{items_preloaded:30,items_to_load:10}},facebook:{init:{appId:"711009162272801",frictionlessRequests:!0,status:!1}}}).constant("application_conf_mobile",{general:{overflowScroll:!1,has_bouncing:!1,scroll:{items_preloaded:30,items_to_load:10}},facebook:{init:{appId:"711009162272801",oauth:!0,localSDK:"facebook-js-sdk.js",nativeInterface:nativeInterface,status:!1,frictionlessRequests:!0,useCachedDialogs:!1,cookies:!0}}}),angular.module("starter.filters",[]).filter("startFrom",function(){return function(a,b){return a?a.slice(b):!1}}).filter("friendsSearch",function(){return function(a,b){var c=[];if(a&&b)angular.forEach(a,function(a){-1!=a.first_name.toLowerCase().indexOf(b.toLowerCase())||-1!=a.last_name.toLowerCase().indexOf(b.toLowerCase())?c.push(a):!1});else if(a&&!b)return a;return c}}),angular.module("starter.controllers",[]).controller("ModalCtrl",["$scope","$ionicModal",function(a,b){a.$watch("getSelectedFriend()",function(b){a.modal&&b&&0==b.length&&a.closeModal()},!0),b.fromTemplateUrl("views/friendsConfirmationModal.html",function(b){a.modal=b},{scope:a,animation:"slide-in-up"}),a.openModal=function(){a.modal.show()},a.closeModal=function(){a.modal.hide()}}]),angular.module("starter").controller("MainCtrl",["$scope","UserService","application_conf","$rootScope","LoadingService",function(a,b,c,d,e){e.showLoading();var f=0;a.$watch(function(){f++}),a.application_conf=c,console.log("CONFIGURATION",c),a.leftButtons=[{type:"button-clear",content:'<i class="icon ion-navicon">',tap:function(){a.$broadcast("toggleSideMenu")}}],a.closeMenu=function(){a.$broadcast("closeSideMenu")},a.$watch(b.initiated,function(a){a&&e.hideLoading()}),a.$watch(b.user,function(b){console.log("user change",b),a.user=b},!0),a.user=b.user,a.cl=function(){}}]),angular.module("starter.controllers").controller("FriendsCtrl",["$scope","UserService","$filter","$timeout","application_conf",function(a,b,c,d,e){a.initiated=!1,a.pageSize=15,a.filter={value:"",limit:e.general.scroll.items_preloaded},a.initFriendsCtrl=function(b){a.initFriendsPartial(b)},a.initFriendsPartial=function(b){console.log("INIT FRIENDS PARTIAL"),a.friends=angular.copy(b),a.down=!1};var f=[{content:"Annuler",tap:function(){a.reset()}}],g=function(b){b?a.rightButtons=f:delete a.rightButtons};a.loadMore=function(){console.log("loadmore"),a.nextPage()},a.checkMoreScroll=function(){console.log(a.filteredFriends,a.virtualFriends),a.filteredFriends&&a.virtualFriends.length==a.filteredFriends.length?(console.log("No more scroll!!!"),a.noMoreScroll=!0):(console.log("Content to scroll !!!"),a.noMoreScroll=!1)},a.resetSearch=function(){a.filter.value="",a.filter.limit=e.general.scroll.items_preloaded,a.searching()},a.filterFriends=function(b){console.log("**FILTER**",b),"bySearch"===b?(a.filteredFriends=c("friendsSearch")(a.friends,a.filter.value),a.virtualFriends=c("limitTo")(a.filteredFriends,a.filter.limit)):"byLimit"===b?a.virtualFriends=c("limitTo")(a.filteredFriends,a.filter.limit):(a.filteredFriends=c("friendsSearch")(a.friends,a.filter.value),a.virtualFriends=c("limitTo")(a.filteredFriends,a.filter.limit)),a.checkMoreScroll(),console.log("BROADCAST:scroll.infiniteScrollComplete"),a.$broadcast("scroll.infiniteScrollComplete")},a.$watch("filter.limit",function(b){console.log("limit:",b,a),b?a.filterFriends("byLimit"):console.log("no limit")}),a.$on("scroll-down",function(b,c){a.down!=c&&d(function(){a.down=c})}),a.nextPage=function(){a.friends&&a.friends.length>a.filter.limit?(console.log("Page suivante"),a.filter.limit+=e.general.scroll.items_to_load):console.log("ignore")},a.previousPage=function(){a.filter.limit>e.general.scroll.items_to_load&&(a.filter.limit-=e.general.scroll.items_to_load)},a.searching=function(){console.log("BROADCAST:scroll.scrollTop"),a.$broadcast("scroll.scrollTop"),a.filter.limit=e.general.scroll.items_preloaded,a.filterFriends("bySearch")},a.reset=function(){angular.forEach(a.friends,function(a){a.enabled=!1})},a.addFriend=function(a,b){"INPUT"!=b.target.tagName&&(a.enabled=a.enabled?!1:!0)},a.getSelectedFriend=function(){return c("filter")(a.friends,{enabled:!0})},a.sendFriendsInvitation=function(c){b.sendFriendsInvitation(a.getSelectedFriend(),c)},a.$watch(b.friends,function(b){console.log("watch friends"),b&&a.initFriendsCtrl(b)}),a.$watch("friends",function(b){b&&(a.filterFriends(),a.getSelectedFriend()&&0==a.getSelectedFriend().length?g(!1):!a.rightButtons&&a.getSelectedFriend()&&a.getSelectedFriend().length>0&&g(!0))},!0)}]),angular.module("starter.controllers").controller("IntroCtrl",["$scope","$state",function(a,b){console.log("INIT INTROCTRL");var c=function(){b.go("menu.home"),window.localStorage.didTutorial=!0};"true"===window.localStorage.didTutorial&&(console.log("Skip intro"),c()),a.next=function(){a.$broadcast("slideBox.nextSlide")};var d=[{content:'<i class="icon ion-chevron-right"></i>',type:"button-positive ion ",tap:function(){a.next()}}],e=[{content:"Passer",type:"button-positive",tap:function(){c()}}];a.leftButtons=e,a.rightButtons=d,a.slideChanged=function(b){a.leftButtons=b>0?[{content:'<i class="icon ion-chevron-left"></i>',type:"button-positive",tap:function(){a.$broadcast("slideBox.prevSlide")}}]:e,a.rightButtons=2==b?[{content:"J'ai tout compris !",type:"button-balanced button",tap:function(){c()}}]:d}}]),angular.module("starter.controllers").controller("HomeCtrl",["$scope","UserService","$state","PaceService","$rootScope",function(a,b,c,d,e){a.paceStart=function(){d.start()},a.login=function(){b.login()},a.toIntro=function(){window.localStorage.didTutorial="false",e.$broadcast("closeSideMenu"),c.go("menu.intro")}}]),angular.module("starter.controllers").controller("leftMenuCtrl",["$scope","UserService","$state",function(a,b,c){a.$on("toggleSideMenu",function(){a.sideMenuController.toggleLeft()}),a.$on("closeSideMenu",function(){a.sideMenuController.close()}),a.closeMenu=function(b){a.sideMenuController.close(),c.go(b)},a.logout=function(){b.logout(function(){c.go("login")})},a.login=function(){b.login()}}]),angular.module("starter.controllers").controller("SubscribedFriendsCtrl",["$scope","UserService","$filter",function(a,b,c){a.initSubscribedFriends=function(){a.$watch(b.friends,function(b){b&&(a.friends=c("filter")(b,{installed:!0}))})}}]),angular.module("starter.services",[]).service("PaceService",["$window",function(a){return{start:function(){console.log("pace"),a.Pace.start(),Pace.start()}}}]),angular.module("starter.services").service("LoadingService",["$ionicLoading",function(a){var b;return{hideLoading:function(){b.hide()},showLoading:function(c){console.log("SHOW FROM SERVICE"),c=c||"Chargement",b=a.show({content:'<i class=" ion-loading-c"></i> '+c,animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:500})}}}]),angular.module("starter.services").service("ConnectService",["$ionicLoading","$window","$rootScope",function(a,b,c){var d,e=function(){d=a.show({content:'<i class=" ion-alert-circled"></i> Une connexion Internet est nécessaire',animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0})},f=function(){d&&d.hide()},g=function(){console.log("Status online"),f()},h=function(){console.log("Status offline"),e()},i={};return i.onLine=b.navigator.onLine,b.navigator.onLine?g():h(),i.isOnline=function(){return i.onLine},b.addEventListener("online",function(){i.onLine=!0,g(),c.$digest()},!0),b.addEventListener("offline",function(){i.onLine=!1,h(),c.$digest()},!0),{offline:function(){h()},online:function(){g()}}}]),angular.module("starter.services").service("UserService",["$rootScope","Facebook","$q","application_conf","$filter","$state","LoadingService",function(a,b,c,d,e,f,g){console.log("INIT USERVICE");var h=!1,i={},j=function(a){console.log("lastTask"),i.logged=!0,h=!0,a.resolve()},k=function(a,b){if(!b&&!h){console.log("OH*********INIT**********",h,a);var d=c.defer(),e=[];return e.push(p()),e.push(o()),c.all(e).then(j(d)),d}console.log("*********IGNORE INIT**********")},l=function(a,b){console.log(b),console.log("Got the user's session: "+JSON.stringify(a)),a.authResponse&&a.authResponse.accessToken?(console.log("Got the user's session: "+JSON.stringify(a.authResponse.accessToken)),k(b)):(console.log("The user is NOT connected (2)"),m())},m=function(){console.log("RESET"),g.hideLoading(),a.$apply(function(){i={},i.logged=!1,h=!1})},n=function(){return b.logout(function(){})},o=function(){console.log("FB:ask friends");var e=c.defer();return b.api("/me/friends?fields="+d.facebook.friends_fields,function(b){b.error?console.log("error:"+JSON.stringify(b.error)):(console.log(b),a.$apply(function(){i.friends=b.data,e.resolve()}))}),e.promise},p=function(){console.log("FB:ask me"),b.api("/me?fields="+d.facebook.me_fields,function(b){console.log("FB:get me",JSON.stringify(b)),b.error?console.log("error",JSON.stringify(b.error)):a.$apply(function(){i.me=b})})},q=function(){console.log("try login"),g.showLoading("Connexion Facebook");var a=c.defer();return b.login(function(b){console.log(b),b.authResponse&&"connected"==b.status?console.log("success login...",b):console.log("Echec login"),g.hideLoading(),a.resolve()},{scope:d.facebook.permissions}),a.promise},r=function(){console.log("getloginstatus");var a=c.defer();return b.getLoginStatus(function(a){l(a,"getLoginStatus")}),a.promise};return a.$watch(function(){return b.isReady()},function(){a.facebookReady=!0}),a.$on("Facebook:login",function(){}),a.$on("Facebook:logout",function(){}),a.$on("Facebook:prompt",function(){console.log("Facebook:prompt")}),a.$on("Facebook:sessionChange",function(){}),a.$on("Facebook:statusChange",function(a,b){l(b,"statusChange")}),a.$on("Facebook:authResponseChange",function(a,b){console.log("Facebook:authResponseChange"),l(b,"authResponseChange")}),r(),{initiated:function(){return h},getLoginStatus:function(){return r()},logged:function(){return i.logged?i:!1},user:function(){return i},login:function(){return q()},profile:function(){return i.profile},friends:function(){return i.friends},subscribedFriends:function(){return i.subscribedFriends},logout:function(){return n()},sendFriendsInvitation:function(a){var b=[];angular.forEach(e("filter")(a),function(a){console.log("ITEM",a),b.push(a.id)}),alert("Try send Invitations to",b,"service désactivé")}}}]),angular.module("starter.directives",[]).directive("jauge",function(){return{scope:{max:"=",current:"="},restrict:"EA",templateUrl:"views/jaugeDirective.html",link:function(a){var b=function(){a.current&&a.max&&(a.prc=a.current/a.max*100)};console.log("linking jauge......."),a.$watch("max",function(){b()}),a.$watch("current",function(){b()})}}}).directive("whenScrolled",["$timeout",function(){return function(a,b){var c,d=b.controller("$ionicScroll"),e=b.find("ion-infinite-scroll"),f=d.scrollView;e&&b.bind("scroll",function(){c<f.getValues().top?a.$emit("scroll-down",!0):c>f.getValues().top&&a.$emit("scroll-down",!1),c=f.getValues().top})}}]).directive("connectivity",["$window","$parse",function(a,b){return function(c,d,e){var f=c.$eval(e.connectivity);angular.forEach(f,function(d,e){switch(console.log("loop",e),fn=b(d),e){case"connect":c.connect=fn,a.addEventListener("online",function(){console.log("Detect Online Event"),c.$apply(function(){fn(c)})},!1);break;case"disconnect":c.disconnect=fn,a.addEventListener("offline",function(){console.log("Detect Offline Event"),c.$apply(function(){fn(c)})},!1)}}),navigator.onLine?(console.log("connect"),c.connect(c)):(console.log("disconnect"),c.disconnect(c))}}]).directive("postRepeatDirective",["$timeout",function(a){return function(b){b.$first&&(window.a=new Date),b.$last&&a(function(){console.log("## DOM rendering list took: "+(new Date-window.a)+" ms")})}}]),angular.module("templates-main",[]);