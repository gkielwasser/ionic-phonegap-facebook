angular.module("starter",["ionic","ngTouch","starter.services","starter.controllers","starter.directives","facebook","checklist-model"]).run(["$rootScope","$state","$urlRouter",function(a,b,c){FastClick.attach(document.body),a.$on("$stateChangeSuccess",function(d,e){d.preventDefault();var f;"true"===window.localStorage.didTutorial?(console.log("Skip intro",e),f=!0,a.enableSideMenu=!0):(console.log("Do intro",e),f=!1,a.enableSideMenu=!1),f?c.sync():b.go("menu.intro")})}]).config(["$stateProvider","$urlRouterProvider","FacebookProvider",function(a,b,c){a.state("menu",{url:"","abstract":!0,templateUrl:"views/menu.html"}).state("menu.friends",{url:"/friends",views:{menuContent:{templateUrl:"views/friends.html",controller:"FriendsCtrl"}}}).state("menu.about",{url:"/about",views:{menuContent:{templateUrl:"views/about.html"}}}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginCtrl"}).state("menu.intro",{url:"/intro",views:{menuContent:{templateUrl:"views/intro.html",controller:"IntroCtrl"}}}),b.otherwise("/about"),c.init("711009162272801")}]).filter("startFrom",function(){return function(a,b){return a?a.slice(b):!1}}),angular.module("starter.controllers",[]).controller("IntroCtrl",["$scope","$state",function(a,b){var c=function(){b.go("menu.about"),window.localStorage.didTutorial=!0};"true"===window.localStorage.didTutorial&&(console.log("Skip intro"),c()),a.next=function(){a.$broadcast("slideBox.nextSlide")};var d=[{content:'<i class="icon ion-chevron-right"></i>',type:"button-positive ion ",tap:function(){a.next()}}],e=[{content:"Passer",type:"button-positive",tap:function(){c()}}];a.leftButtons=e,a.rightButtons=d,a.slideChanged=function(b){a.leftButtons=b>0?[{content:'<i class="icon ion-chevron-left"></i>',type:"button-positive",tap:function(){a.$broadcast("slideBox.prevSlide")}}]:e,a.rightButtons=2==b?[{content:"J'ai tout compris !",type:"button-balanced button",tap:function(){c()}}]:d}}]).controller("ModalCtrl",["$scope","$ionicModal",function(a,b){b.fromTemplateUrl("views/friendsConfirmationModal.html",function(b){a.modal=b},{scope:a,animation:"slide-in-up"}),a.contacts=[{name:"Gordon Freeman"},{name:"Barney Calhoun"},{name:"Lamarr the Headcrab"}],a.openModal=function(){a.modal.show()},a.closeModal=function(){a.modal.hide()}}]).controller("FriendsCtrl",["$scope","UserService","$timeout","$q","$filter",function(a,b,c,d,e){a.$watch(b.friends,function(b){b&&a.initFriendsCtrl(b)}),a.initFriendsCtrl=function(b){a.initFriendsPartial(b)},a.initFriendsPartial=function(b){a.friends=b,a.currentPage=0,a.pageSize=15,a.numberOfPages=function(){return Math.ceil(e("filter")(a.friends,a.search).length/a.pageSize)}},a.setCurrentPage=function(b){a.currentPage=b},a.nextPage=function(){a.currentPage++},a.previousPage=function(){a.currentPage--},a.getNumberAsArray=function(a){return new Array(a)},a.selectedFriends=[],a.addFriend=function(b,c){console.log("s",c),"INPUT"!=c.target.tagName?-1==a.selectedFriends.indexOf(b)?a.selectedFriends.push(b):a.selectedFriends.splice(a.selectedFriends.indexOf(b),1):console.log("ignore")},a.addItems=function(){for(var b=0;10>b;b++)if(a.friends.push(),a.friends.length>=a.maxItems)return void(a.canLoad=!1)}}]).controller("leftMenuCtrl",["$scope","UserService","$state",function(a,b,c){a.$on("openSideMenu",function(){a.sideMenuController.toggleLeft()}),a.closeMenu=function(b){a.sideMenuController.close(),c.go(b)},a.logout=function(){b.logout(function(){c.go("login")})},a.login=function(){b.login()}}]).controller("MainCtrl",["$scope","$state","UserService",function(a,b,c){a.leftButtons=[{type:"button-clear",content:'<i class="icon ion-navicon">',tap:function(){a.$broadcast("openSideMenu")}}],a.$watch(c.logged,function(b){a.user=b}),a.toIntro=function(){window.localStorage.didTutorial="false",a.$broadcast("openSideMenu"),b.go("menu.intro")}}]),angular.module("starter.services",[]).factory("UserService",["$rootScope","Facebook","$ionicLoading","$q",function(a,b,c,d){a.showLoading=function(){a.loading=c.show({content:'<i class=" ion-loading-c"></i> Chargement',animation:"fade-in",showBackdrop:!0,maxWidth:200,showDelay:0})},a.hideLoading=function(){a.loading.hide()},a.$watch(function(){return b.isReady()},function(){a.facebookReady=!0});var e={},f=!1;a.$on("Facebook:login",function(b,c){a.$apply(function(){"connected"!=c.status||f?h():(console.log("Connexion de",c),g(),f=!0)})}),a.$on("Facebook:logout",function(b,c){a.$apply(function(){console.log("Facebook:logout",c),h()})}),a.$on("Facebook:prompt",function(a,b){console.log("Facebook:prompt",b)}),a.$on("Facebook:sessionChange",function(a,b){console.log("Facebook:sessionChange",b)}),a.$on("Facebook:statusChange",function(a,b){"connected"==b.status||h()}),a.$on("Facebook:authResponseChange",function(){});var g=function(){a.showLoading();var b=d.defer();return j(),i().then(function(){b.resolve(),a.hideLoading()}),b.promise},h=function(){e={},f=!1},i=function(){var c=d.defer();return b.api("/me/friends?fields=name,first_name,picture",function(b){a.$apply(function(){e.friends=b.data,c.resolve()})}),c.promise},j=function(){b.api("/me",function(b){a.$apply(function(){e.me=b})})},k=function(){var a=d.defer();return b.login(function(){a.resolve()}),a.promise},l=function(){var c=d.defer();return b.getLoginStatus(function(b){a.$apply("connected"==b.status?function(){a.loggedIn=!0,c.resolve("connected")}:function(){a.loggedIn=!1,c.resolve()})}),c.promise};return{getLoginStatus:function(){return l()},logged:function(){return e.me?e.me:!1},login:function(){return k()},profile:function(){return e.profile},friends:function(){return e.friends},logout:function(){return console.log("logout"),b.logout(function(){})}}}]),angular.module("starter.directives",[]).directive("whenScrolled",["$timeout",function(a){return function(b,c){var d,e=c[0];a(function(){e.scrollTop=e.scrollHeight,console.log("init",e)}),c.bind("scroll",function(){console.log(d,e.scrollTop),console.log(d>e.scrollTop?"mont√©e":"descente"),d=e.scrollTop})}}]);